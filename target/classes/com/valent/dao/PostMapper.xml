<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<!--namespace绑定一个对应的dao/mapper接口-->
<mapper namespace="com.valent.dao.PostMapper">

    <sql id="query_post_clause">
        <if test="title != null and title != ''">
            and title like concat('%',#{title},'%')
        </if>
    </sql>

    <!--query all the posts-->
    <select id="selectAll" resultType="com.valent.pojo.Post">
    select * from community.post
    <where>
        <include refid="query_post_clause"></include>
    </where>
    limit #{beginPage},#{pageCount}
    </select>

    <!--get the number of record-->
    <select id="getTotal"  resultType="java.lang.Integer" parameterType="string" >
        select count(1) from community.post
        <where>
            <include refid="query_post_clause"></include>
        </where>
    </select>

    <!--inser a posty-->
    <insert id="insertPost" parameterType="Post">
        insert into community.post(userid,tagid,title,content,createtime,updatetime)
        values (#{userId},#{tagId},#{title},#{content},#{createTime},#{updateTime})
    </insert>


    <select id="selectById" parameterType="java.lang.Integer" resultType="Post">
        select * from community.post where postid=#{id}
    </select>

    <update id="AddViewCount" parameterType="java.lang.Integer" >
        update community.post set viewcount=viewcount+1 where postid=#{id};
    </update>

    <select id="selectByUserId" parameterType="java.lang.Integer" resultType="Post">
        select * from community.post where userId=#{userId}
    </select>

    <delete id="deletePost" parameterType="java.lang.Integer">
        delete from community.post where postId=#{postId}
    </delete>
</mapper>
